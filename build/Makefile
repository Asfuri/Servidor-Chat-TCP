# ==============================================================================
# CONFIGURA√á√ïES DO COMPILADOR
# ==============================================================================
CXX = g++
CXXFLAGS = -std=c++17 -Wall -Wextra -O2 -pthread

# ==============================================================================
# ESTRUTURA DE DIRET√ìRIOS
# ==============================================================================
SRC_DIR = ../src
LIB_DIR = ../lib
OBJ_DIR = obj
BUILD_DIR = .

# ==============================================================================
# ARQUIVOS
# ==============================================================================
SOURCES = $(SRC_DIR)/libtslog.cpp $(SRC_DIR)/main_server.cpp
HEADERS = $(LIB_DIR)/libtslog.h $(LIB_DIR)/logEntry.h
OBJECTS = $(OBJ_DIR)/libtslog.o $(OBJ_DIR)/main_server.o
TARGET = chat_server

# ==============================================================================
# ALVOS PRINCIPAIS
# ==============================================================================
.PHONY: all clean clean-obj run help

all: $(TARGET)

$(TARGET): $(OBJECTS)
	@echo "üîó Linkando execut√°vel: $@"
	$(CXX) $(CXXFLAGS) $(OBJECTS) -o $@
	@$(MAKE) clean-obj
	@echo "‚úÖ Compila√ß√£o conclu√≠da com sucesso!"
	@echo "‚ñ∂Ô∏è  Execute com: ./$(TARGET)"

# ==============================================================================
# COMPILA√á√ÉO DE OBJETOS
# ==============================================================================
$(OBJ_DIR):
	@mkdir -p $(OBJ_DIR)

$(OBJ_DIR)/%.o: $(SRC_DIR)/%.cpp $(HEADERS) | $(OBJ_DIR)
	@echo "üî® Compilando: $<"
	$(CXX) $(CXXFLAGS) -I$(LIB_DIR) -c $< -o $@

# ==============================================================================
# LIMPEZA
# ==============================================================================
clean: clean-obj
	rm -f $(TARGET)
	rm -f chat_server.log
	@echo "‚úÖ Limpeza completa (execut√°vel, logs, objetos)"

clean-obj:
	rm -rf $(OBJ_DIR)
	@echo "‚úÖ Objetos removidos ( $(OBJ_DIR) )"

# ==============================================================================
# EXECU√á√ÉO
# ==============================================================================
run: all
	@echo "üöÄ Executando $(TARGET)..."
	./$(TARGET)

# ==============================================================================
# AJUDA
# ==============================================================================
help:
	@echo "Makefile - Servidor de Chat TCP"
	@echo "  all           - Compila o execut√°vel e limpa objetos"
	@echo "  run           - Compila e executa"
	@echo "  clean         - Remove execut√°vel, logs e objetos"
	@echo "  clean-obj     - Remove apenas objetos"
	@echo "  help          - Exibe esta ajuda"
